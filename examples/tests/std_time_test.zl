use std.time

fun main() >> i32 {
    @printf("=== Testing zlang std.time module ===\n");
    
    ?? Test basic time functions
    @printf("\n1. Testing basic time functions:\n");
    i64 current_time = now();
    @printf("Current timestamp: %ld\n", current_time);
    
    i64 millis = nowMillis();
    @printf("Current time in millis (approx): %ld\n", millis);
    
    ?? Test time string
    ptr<u8> time_str = timeString();
    @printf("Current time string: %s", time_str);
    
    ?? Test timer functionality
    @printf("\n2. Testing Timer functionality:\n");
    Timer timer = timerStart();
    @printf("Timer started...\n");
    
    ?? Sleep for a short time to test timer
    @printf("Sleeping for 1 second...\n");
    sleepSeconds(1);
    
    f64 elapsed = timerElapsed(timer);
    @printf("Elapsed time: %.2f seconds\n", elapsed);
    
    if (elapsed < 0.9 || elapsed > 1.2) {
        @printf("ERROR: Timer elapsed time seems incorrect!\n");
        return 1;
    }
    
    ?? Test timer stop
    timer = timerStop(timer);
    @printf("Timer stopped.\n");
    
    ?? Test timer reset
    @printf("\n3. Testing timer reset:\n");
    Timer reset_timer = timerReset(timer);
    f64 reset_elapsed = timerElapsed(reset_timer);
    @printf("Time after reset: %.2f seconds\n", reset_elapsed);
    
    if (reset_elapsed > 0.1) {
        @printf("ERROR: Timer reset didn't work properly!\n");
        return 1;
    }
    
    ?? Test timer expiration
    @printf("\n4. Testing timer expiration:\n");
    Timer exp_timer = timerStart();
    bool expired_before = timerExpired(exp_timer, 0.5);
    @printf("Timer expired before wait: ");
    if (expired_before) {@printf("true\n");} else {@printf("false\n");}
    
    if (expired_before) {
        @printf("ERROR: Timer should not be expired immediately!\n");
        return 1;
    }
    
    ?? Test millisecond sleep (using 2 second sleep for better accuracy)
    @printf("\n5. Testing millisecond sleep:\n");
    Timer ms_timer = timerStart();
    @printf("Sleeping for 2000 milliseconds...\n");
    sleepMillis(2000);
    f64 ms_elapsed = timerElapsed(ms_timer);
    @printf("Elapsed after 2000ms sleep(expected 2.000):%.3f seconds\n", ms_elapsed);
    
    if (ms_elapsed < 1.8 || ms_elapsed > 2.5) {
        @printf("ERROR: Millisecond sleep timing seems incorrect!\n");
        return 1;
    }
    
    ?? Test time difference
    @printf("\n6. Testing time difference:\n");
    i64 time1 = now();
    sleepSeconds(1);
    i64 time2 = now();
    f64 diff = timeDiff(time2, time1);
    @printf("Time difference(expected 1.00):%.2f seconds\n", diff);
    
    if (diff < 0.9 || diff > 1.5) {
        @printf("ERROR: Time difference calculation seems incorrect!\n");
        return 1;
    }
    
    ?? Test microsecond sleep (1 second for better accuracy)
    @printf("\n7. Testing microsecond sleep:\n");
    Timer micro_timer = timerStart();
    sleepMicros(1000000); ?? 1 second in microseconds
    f64 micro_elapsed = timerElapsed(micro_timer);
    @printf("Elapsed after 1000000 microseconds sleep(expected 1.000):%.3f seconds\n", micro_elapsed);
    
    @printf("\n=== All time module tests completed successfully! ===\n");
    return 0;
}
