use std.time

fun main() >> i32 {
    @printf("=== Testing zlang std.time module ===\n");

    ?? Test basic time functions
    @printf("\n1. Testing basic time functions:\n");
    i64 current_time = now();
    @printf("Current timestamp: %ld\n", current_time);

    i64 millis = nowMillis();
    @printf("Current time in millis (approx): %ld\n", millis);

    if (current_time <= 0) {
        @printf("ERROR: now() returned invalid timestamp!\n");
        return 1;
    }

    i64 lower_bound = current_time * 1000;
    i64 upper_bound = lower_bound + 2000;
    if (millis < lower_bound || millis > upper_bound) {
        @printf("ERROR: nowMillis() out of expected range!\n");
        return 1;
    }

    ?? Test time string
    ptr<u8> time_str = timeString();
    @printf("Current time string: %s", time_str);

    if (time_str == null) {
        @printf("ERROR: timeString() returned null!\n");
        return 1;
    }

    ?? Test timer functionality
    @printf("\n2. Testing Timer functionality:\n");
    Timer timer = timerStart();
    @printf("Timer started and checked immediately...\n");

    f64 elapsed = timerElapsed(timer);
    @printf("Elapsed time: %.2f seconds\n", elapsed);

    if (elapsed < 0.0 || elapsed > 2.0) {
        @printf("ERROR: Timer elapsed time out of range!\n");
        return 1;
    }

    ?? Test timer stop
    timer = timerStop(timer);
    @printf("Timer stopped.\n");

    ?? Test timer reset
    @printf("\n3. Testing timer reset:\n");
    Timer reset_timer = timerReset(timer);
    f64 reset_elapsed = timerElapsed(reset_timer);
    @printf("Time after reset: %.2f seconds\n", reset_elapsed);

    if (reset_elapsed < 0.0 || reset_elapsed > 2.0) {
        @printf("ERROR: Timer reset didn't work properly!\n");
        return 1;
    }

    ?? Test timer expiration
    @printf("\n4. Testing timer expiration:\n");
    Timer exp_timer = timerStart();
    bool expired_now = timerExpired(exp_timer, 0.0);
    bool expired_before = timerExpired(exp_timer, 2.0);
    @printf("Timer expired at 0.0s threshold: ");
    if (expired_now) {@printf("true\n");} else {@printf("false\n");}
    @printf("Timer expired before wait: ");
    if (expired_before) {@printf("true\n");} else {@printf("false\n");}

    if (!expired_now) {
        @printf("ERROR: Timer should be expired at 0.0 threshold!\n");
        return 1;
    }

    if (expired_before) {
        @printf("ERROR: Timer should not be expired immediately!\n");
        return 1;
    }

    ?? Test fast sleeps (no long waits)
    @printf("\n5. Testing fast sleeps:\n");
    sleepMicros(1000);
    sleepMillis(1);
    sleepSeconds(0);
    @printf("Short sleep calls completed.\n");

    ?? Test time difference without waiting
    @printf("\n6. Testing time difference:\n");
    i64 time1 = now();
    i64 time2 = now();
    f64 diff = timeDiff(time2, time1);
    @printf("Time difference: %.2f seconds\n", diff);

    if (diff < 0.0) {
        @printf("ERROR: Time difference calculation seems incorrect!\n");
        return 1;
    }

    @printf("\n=== All time module tests completed successfully! ===\n");
    return 0;
}
